<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
</head>

<body>
    <h1 id="heading"></h1>
    <p>Login here</p>
    <form id="login-form" type="POST">
        <div>
            Username: <input name="username" />
        </div>
        <div>
            Password: <input name="password" type="password" />
        </div>
        <button id="login-button" type="submit">Login</button>
    </form>
    <output id="login-result" for="login-form"></output>
    <script>
        function saveCookie(name, value, expiration = -1) {
            let expirationString = "";
            if (expiration.length > 0) {
                let expireDate = new Date(expiration);
                let expireDateString = expireDate.toUTCString();
                expirationString = `; expires=${expireDateString}`;
            }
            const cookieString = `${name}=${value}${expirationString}; path=/;`;
            console.log(`Saving new cookie: ${cookieString}`);
            document.cookie = cookieString;
        }

        const loginForm = document.getElementById('login-form');
        loginForm.addEventListener("submit", (event) => {
            console.log("Form submitted");
            event.preventDefault();

            const formData = new FormData(loginForm);

            fetch('/api/login', {
                method: "POST",
                body: formData,
            })
                .then((resp) => resp.json())
                .then((json) => {
                    console.log("Form result received");
                    const h1 = document.getElementById('login-result');
                    h1.textContent = JSON.stringify(json);
                    const newSession = json.data.loginSession;
                    const token = newSession.token;
                    const expires = newSession.expiration;
                    // saveCookie('session', token, expires);
                    console.log(`New cookie state: ${JSON.stringify(document.cookie)}`);
                });

        });
    </script>
</body>

</html>